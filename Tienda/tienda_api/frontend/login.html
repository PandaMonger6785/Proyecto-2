{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Iniciar sesión</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}?v=12">
  <style>
    .error-msg {
      color: #b91c1c;
      background: #fee2e2;
      border: 1px solid #fca5a5;
      border-radius: 8px;
      padding: 8px;
      margin-top: 8px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body class="login-page">
  <div class="login-container">
    <h2 style="margin-top:0">Iniciar sesión</h2>

    {% if form.errors %}
      <div class="error-msg">
        Usuario o contraseña incorrectos.
      </div>
    {% endif %}

    <form id="loginForm" method="post" novalidate>
      {% csrf_token %}
      <div>
        <label>Usuario</label>
        <input type="text" id="username" name="username" required autofocus>
      </div>
      <div>
        <label>Contraseña</label>
        <input type="password" id="password" name="password" required>
      </div>

      <button class="btn btn-primary" type="submit" style="width:100%">Entrar</button>
      <div id="errorContainer"></div>
    </form>

    <p style="margin-top:12px">
      ¿No tienes cuenta? <a href="{% url 'signup' %}">Crear una</a>
    </p>
    <p><a href="{% url 'home' %}">← Volver a la tienda</a></p>
  </div>

  <!-- === Validación con JavaScript === -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("loginForm");
      const username = document.getElementById("username");
      const password = document.getElementById("password");
      const errorContainer = document.getElementById("errorContainer");

      form.addEventListener("submit", function (e) {
        e.preventDefault(); // Evita el envío hasta validar
        errorContainer.innerHTML = ""; // Limpia errores previos

        const userVal = username.value.trim();
        const passVal = password.value;

        let errors = [];

        if (!userVal) {
          errors.push("⚠️ El campo de usuario no puede estar vacío.");
        }
        if (passVal.length < 6) {
          errors.push("⚠️ La contraseña debe tener al menos 6 caracteres.");
        }

        if (errors.length > 0) {
          const html = `<div class="error-msg">${errors.join("<br>")}</div>`;
          errorContainer.innerHTML = html;
          return false;
        }

        // Si pasa validaciones, envía el formulario
        form.submit();
      });
    });
  </script>
</body>
</html>
