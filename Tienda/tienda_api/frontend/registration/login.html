{% extends "base.html" %}
{% load static %}

{% block title %}Iniciar sesión - TiendaExpress{% endblock %}
{% block body_class %}login-page{% endblock %}

{% block content %}
<section class="login-container">
  <h2 style="margin-top:0">Iniciar sesión</h2>

  {% if form.errors %}
  <div class="error-msg">Usuario o contraseña incorrectos.</div>
  {% endif %}

  <form id="loginForm" method="post" action="{% url 'tienda:login' %}" novalidate>
    {% csrf_token %}
    <div class="form-group">
      <label for="id_username">Usuario</label>
      {{ form.username }}
    </div>
    <div class="form-group">
      <label for="id_password">Contraseña</label>
      {{ form.password }}
    </div>

    {% if next %}
    <input type="hidden" name="next" value="{{ next }}">
    {% endif %}

    <div id="errorContainer"></div>
    <button class="btn btn-primary" type="submit" style="width:100%">Entrar</button>
  </form>

  <p class="meta" style="margin-top:12px">
    ¿No tienes cuenta? <a href="{% url 'tienda:signup' %}">Crear una</a>
  </p>
  <p><a href="{% url 'tienda:home' %}">← Volver a la tienda</a></p>
</section>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("loginForm");
    const username = form.querySelector("input[name='username']");
    const password = form.querySelector("input[name='password']");
    const errorContainer = document.getElementById("errorContainer");

    form.addEventListener("submit", function (e) {
      errorContainer.innerHTML = "";
      const userVal = (username.value || "").trim();
      const passVal = password.value || "";
      const errors = [];

      if (!userVal) {
        errors.push("⚠️ El campo de usuario no puede estar vacío.");
      }
      if (!passVal) {
        errors.push("⚠️ La contraseña es obligatoria.");
      }

      if (errors.length > 0) {
        e.preventDefault();
        errorContainer.innerHTML = `<div class="error-msg">${errors.join("<br>")}</div>`;
      }
    });
  });
</script>
{% endblock %}